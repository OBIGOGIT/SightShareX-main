var initPage=function(){companies();roles();var a=getID("txtPw");a.lowChk=!1;a.upChk=!1;a.numChk=!1;a.lenChk=!1},NPM_STATUS=0,companies=function(){Log.d("companies() called...");axios.post("/common/company/active/clist").then(function(a){a=a.data;var c=a.length;Log.d("companies() -> data : ",a);for(var b="",d=0;d<c;d++)b+='<option value="%s">%s</option>'.sprintf(a[d].company_id,a[d].company_name);getID("selCompany").innerHTML+=b}).catch(function(a){Log.d("companies() -> error=",a)})},roles=function(){Log.d("roles() called...");
axios.post("/common/role/clist").then(function(a){a=a.data;var c=a.length;Log.d("roles() -> data : ",a);for(var b="",d=0;d<c;d++)b+='<option value="%s">%s</option>'.sprintf(a[d].role_id,a[d].role_name);getID("selRole").innerHTML+=b;"I"!=queryString("mode")&&accountDetailInfo()}).catch(function(a){Log.d("roles() -> error=",a)})};
if("I"!=queryString("mode"))var accountDetailInfo=function(){Log.d("accountDetailInfo() called...");var a=new URLSearchParams;a.append("accountSeq",queryString("accountSeq"));Log.d("params : ",a);axios.post("/manage/account/detail",a).then(function(a){a=a.data;Log.d("accountDetailInfo() -> data : ",a);0<a.length&&(getID("txtEmail").value=a[0].user_email,getID("txtName").value=a[0].name,getID("selCompany").value=a[0].company_id,getID("selRole").value=a[0].role_id,getID("selActive").value=a[0].status_id,
"0"==a[0].email_noti?getID("chkNotify").checked=!1:getID("chkNotify").checked=!0,getID("txtLoginFailCnt").value=a[0].login_fail_count,getID("txtUpdatedEmail").value=a[0].update_email,getID("txtCreatedDate").value=utcToLoc(a[0].created),getID("txtUpdatedDate").value=utcToLoc(a[0].updated))}).catch(function(a){Log.d("accountDetailInfo() -> error=",a)})};window.addEventListener("DOMContentLoaded",function(){Log.d("accountdetail.js -> DOMContentLoaded() called...");initPage()});
null!=getID("btnSave")&&(getID("btnSave").onclick=function(a){Log.d("accountdetail.js -> btnSave() called...");if(null!=getID("chkRegNpm")&&getID("chkRegNpm").checked&&0==NPM_STATUS)modalAlert("You have to check NPM ID registration.");else{a=getVal("txtEmail").toLowerCase();if("I"==queryString("mode")){if(!checkEmail(a)){modalAlert("Email is required.");getID("txtEmail").focus();return}if("none"==getID("spEmailStatus").style.display){modalAlert("Email duplication check is required.");return}}var c=
getVal("txtName");if(""==c.trim())modalAlert("User name is required."),getID("txtName").focus();else{if("I"==queryString("mode")){if("valid"!=getID("spPwStatus").innerText||"valid"!=getID("spCfPwStatus").innerText){modalAlert("Password validation check is required.");return}}else if(0<getVal("txtPw").length&&("valid"!=getID("spPwStatus").innerText||"valid"!=getID("spCfPwStatus").innerText)){modalAlert("Password validation check is required.");return}if("-1"==getVal("selCompany"))modalAlert("Please select company.");
else{var b=new URLSearchParams;b.append("mode",queryString("mode"));b.append("email",a);b.append("name",c);b.append("pw",sha256(getVal("txtPw")));b.append("companyId",getVal("selCompany"));b.append("roleId",getVal("selRole"));b.append("statusId",getVal("selActive"));getID("chkNotify").checked?b.append("emailNoti","1"):b.append("emailNoti","0");"I"!=queryString("mode")&&b.append("loginFailCnt",getVal("txtLoginFailCnt"));axios.post("/manage/account/modify",b).then(function(a){Log.d("response.data : ",
a.data);"failed"==a.data.result?modalAlert("Processing failed."):"redirect"==a.data.result?mv(a.data.cmd):(Log.d("/manage/account/modify : \ucc98\ub9ac \uc131\uacf5"),mv("/manage/account/list.do"))}).catch(function(a){Log.d("btnSave() -> error=",a)})}}}});
null!=getID("chkRegNpm")&&(getID("chkRegNpm").onchange=function(a){Log.d("chkRegNpm() -> e.target.checked : ",a.target.checked);getID("npm-container").style.display="";a.target.checked?(""==getID("selNpmRole").innerHTML&&npmRoles(),getID("txtNpmId").value=getPreFix("@",getVal("txtEmail")),getID("txtNpmPw").value=getID("txtNpmId").value,getID("txtConfirmNpmPw").value=getID("txtNpmId").value,getID("npm-container").style.display=""):(getID("txtNpmId").value="",getID("txtNpmPw").value="",getID("txtConfirmNpmPw").value=
"",getID("npm-container").style.display="none");checkNpmPw()});var checkNpmPw=function(){getID("txtNpmPw").value==getID("txtConfirmNpmPw").value?(getID("spCfNpmPwStatus").classList.add("label-success"),getID("spCfNpmPwStatus").classList.remove("label-danger"),getID("spCfNpmPwStatus").innerText="valid"):(getID("spCfNpmPwStatus").classList.add("label-danger"),getID("spCfNpmPwStatus").classList.remove("label-success"),getID("spCfNpmPwStatus").innerText="invalid")};
null!=getID("txtConfirmNpmPw")&&(getID("txtConfirmNpmPw").onkeyup=function(){Log.d("accountdetail.js -> txtConfirmNpmPw() called...");checkNpmPw()});
null!=getID("btnNpmChk")&&(getID("btnNpmChk").onclick=function(a){Log.d("accountdetail.js -> btnNpmChk() called...");a=getVal("txtNpmId");if(""==a)modalAlert('"NPM ID" is required.'),getID("txtNpmId").focus();else{var c=new URLSearchParams;c.append("id",a);axios.post("/npm/checkid",c).then(function(a){a=JSON.parse(a.data.result);Log.d("result : ",a);null==a?(getID("spNpmIdStatus").classList.remove("label-danger"),getID("spNpmIdStatus").classList.add("label-success"),getID("spNpmIdStatus").innerHTML=
"available"):(getID("spNpmIdStatus").classList.remove("label-success"),getID("spNpmIdStatus").classList.add("label-danger"),getID("spNpmIdStatus").innerHTML="exist",a="NPM ID : %s<br />email : %s<br />role : %s".sprintf(a.userId,a.emailAddress,a.roles[0].roleId),modalAlert(a))}).catch(function(a){Log.d("btnNpmChk() -> error=",a)})}});
var npmRoles=function(){Log.d("npmRoles() called...");axios.post("/npm/roles").then(function(a){a=JSON.parse(a.data.result);var c=0;0<a.length&&(c=a.length);Log.d("result : ",a);Log.d("len : ",c);for(var b="",d=0;d<c;d++)b+='<option value="%s">%s</option>'.sprintf(a[d].roleId,a[d].roleId);getID("selNpmRole").innerHTML=b;getID("selNpmRole").value="nx-anonymous"}).catch(function(a){Log.d("npmRoles() -> error=",a)})};
null!=getID("btnInsertNpm")&&(getID("btnInsertNpm").onclick=function(a){Log.d("accountdetail.js -> btnInsertNpm() called...");if("available"!=getID("spNpmIdStatus").innerHTML)modalAlert('Check "NPM ID".'),getID("txtNpmId").focus();else if(""==getVal("txtEmail"))modalAlert("Email is required."),getID("txtEmail").focus();else if(0==getVal("txtNpmPw").length||0==getVal("txtConfirmNpmPw").length)modalAlert('Check "NPM password is empty."'),getID("txtNpmPw").focus();else if(getVal("txtNpmPw")!=getVal("txtConfirmNpmPw"))modalAlert('Check "NPM password is incorrect."'),
getID("txtNpmPw").focus();else{var c=getVal("txtNpmId");a=getVal("txtEmail");var b=getVal("txtNpmPw"),d=getVal("selNpmRole");a={id:c,first_name:c,last_name:c,email:a,password:b,roles:[d]};b=new URLSearchParams;b.append("content",JSON.stringify(a));axios.post("/npm/insert",b).then(function(a){Log.d("response.data.result : ",a.data.result);-1!=a.data.result.toLowerCase().indexOf("orecordduplicatedexception")?modalAlert("Duplicated NPM ID."):(modalAlert('"'+c+'" registered successfully.'),NPM_STATUS=
1)}).catch(function(a){Log.d("btnInsertNpm() -> error=",a)})}});getID("btnList").onclick=function(a){Log.d("accountdetail.js -> btnList() called...");mv("/manage/account/list.do")};
getID("txtConfirmPw").onkeyup=function(){Log.d("accountdetail.js -> txtConfirmPw() called...");"valid"==getID("spPwStatus").innerText&&getID("txtPw").value==getID("txtConfirmPw").value?(getID("spCfPwStatus").classList.add("label-success"),getID("spCfPwStatus").classList.remove("label-danger"),getID("spCfPwStatus").innerText="valid"):(getID("spCfPwStatus").classList.add("label-danger"),getID("spCfPwStatus").classList.remove("label-success"),getID("spCfPwStatus").innerText="invalid")};
"I"==queryString("mode")&&(getID("btnEmailChk").onclick=function(a){Log.d("btnEmailChk() called...");a=getVal("txtEmail").toLowerCase();if(checkEmail(a)){var c=new URLSearchParams;c.append("email",a);axios.post("/manage/account/checkemail",c).then(function(a){Log.d("response.data : ",a.data);0==a.data[0].count?(getID("spEmailStatus").style.display="",getID("hdnEmail").value=getVal("txtEmail").toLowerCase()):(getID("spEmailStatus").style.display="none",modalAlert("This email is already in use."))}).catch(function(a){Log.d("btnCheckDupProduct() -> error=",
a)})}else modalAlert("Email validation check is required."),getID("txtEmail").focus()});
getID("txtPw").onkeyup=function(){0>=this.value.length?(getID("spPwStatus").innerText="invalid",getID("spPwStatus").classList.remove("label-danger"),getID("spPwStatus").classList.remove("label-success"),getID("spCfPwStatus").innerText="invalid",getID("spCfPwStatus").classList.remove("label-danger"),getID("spCfPwStatus").classList.remove("label-success")):(getID("txtConfirmPw").onkeyup(),this.value.match(/[a-z]/g)?this.lowChk=!0:this.lowChk=!1,this.value.match(/[A-Z]/g)?this.upChk=!0:this.upChk=!1,
this.value.match(/[0-9]/g)?this.numChk=!0:this.numChk=!1,8<=this.value.length?(this.lenChk=!0,256<this.value.length&&(this.lenChk=!1)):this.lenChk=!1,this.lowChk&&this.upChk&&this.numChk&&this.lenChk?(getID("spPwStatus").classList.add("label-success"),getID("spPwStatus").classList.remove("label-danger"),getID("spPwStatus").innerText="valid"):(getID("spPwStatus").classList.add("label-danger"),getID("spPwStatus").classList.remove("label-success"),getID("spPwStatus").innerText="invalid"))};
"I"==queryString("mode")&&(getID("txtEmail").onkeyup=function(){""==getID("spEmailStatus").style.display&&getID("txtEmail").value.toLowerCase()!=getID("hdnEmail").value&&(getID("spEmailStatus").style.display="none")});getID("selActive").onchange=function(){"1"==this.value&&(getID("txtLoginFailCnt").value="0")};
