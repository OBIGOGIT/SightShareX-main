var UPLOAD={READY:0,PROGRESS:1,FINISH:2},initPage=function(){getID("pgUpload").uploadStatus=UPLOAD.READY},pageChange=function(a,b){Log.d("pageChange() -> page : ",a," size: ",b);companies.getSelectCompany(a)},makeDynamicColumn=function(){getID("ext-col-container").innerHTML="";var a=new URLSearchParams;a.append("productType",queryString("productType"));axios.post("/product/extfield/flist",a).then(function(a){a=a.data;var b=a.length;if(!(0>=b)){Log.d("makeDynamicColumn() -> r : ",a);for(var d="",f=
0;f<b;f++)d+='<div class="col-md-6">\t\t\t<div class="form-group">\t\t\t\t<label>%s</label>\t\t\t\t<select id="ext_type_%s" class="form-control select2 ext_type">\t\t\t\t</select>\t\t\t</div>\t\t </div>'.sprintf(a[f].ext_value,a[f].ext_type);getID("ext-col-container").innerHTML=d;for(d=0;d<b;d++)getExtColVal(a[d].ext_value,a[d].ext_type)}}).catch(function(a){Log.d("makeDynamicColumn() -> error=",a)})},getExtColVal=function(a,b){var c="ext_type_%s".sprintf(b);a=new URLSearchParams;a.append("extType",
b);axios.post("/product/extfield/clist",a).then(function(a){a=a.data;var d=a.length;if(!(0>=d)){Log.d("getExtColVal() -> r : ",a);for(var e=0;e<d;e++)getID(c).innerHTML+='<option value="%s">%s</option>'.sprintf(a[e].col_value_id,a[e].col_value);getSelectExtVal(c,queryString("productId"),b)}}).catch(function(a){Log.d("error=",a)})},getSelectExtVal=function(a,b,c){Log.d("getSelectExtVal() -> productId : ",b,"extType : ",c,"sel : ",a);var d=new URLSearchParams;d.append("productId",b);d.append("extType",
c);axios.post("/product/extfield/selected",d).then(function(b){b=b.data;0>=b.length||(Log.d("getSelectExtVal() -> r : ",b),getID(a).value=b[0].col_value_id)}).catch(function(a){Log.d("error=",a)})},productDetail=function(){Log.d("productDetail() called...");var a=new URLSearchParams;a.append("productId",queryString("productId"));axios.post("/product/modify/detail",a).then(function(a){0<a.data.length&&(Log.d("productDetail() -> response.data : ",a.data),getID("txtProductName").value=a.data[0].name,
getID("txtVersion").value=a.data[0].version,getID("txtDesc").value=a.data[0].description,getID("selStatus").value=a.data[0].active,getID("txtEmail").value=a.data[0].user_email,getID("txtCreated").value=utcToLoc(a.data[0].created),getID("txtUpdated").value=utcToLoc(a.data[0].updated),void 0!==a.data[0].size&&(getID("hdnFileSize").value=a.data[0].size,getID("txtFileSize").value=hFS(a.data[0].size)),void 0!==a.data[0].filename&&(getID("hdnFilename").value=a.data[0].filename,getID("hdnOldFilename").value=
a.data[0].filename,getID("spFilename").innerText=a.data[0].filename),void 0!==a.data[0].filepath&&(getID("hdnFilepath").value=a.data[0].filepath,getID("hdnOldFilepath").value=a.data[0].filepath),void 0!==a.data[0].product_file_id&&(getID("hdnProductFileId").value=a.data[0].product_file_id),void 0!==a.data[0].is_link_help&&(getID("chkUseHelpLink").checked=a.data[0].is_link_help,showHelpStatus(a.data[0].is_link_help),a.data[0].is_link_help?void 0!==a.data[0].help_fullpath?(getID("txtHelpLink").value=
a.data[0].help_fullpath,getID("btnHelpLinkDelete").style.display=""):getID("btnHelpLinkDelete").style.display="none":void 0!==a.data[0].help_fullpath?(getID("spHelpFileFullPath").innerText=a.data[0].help_fullpath,getID("btnHelpFileDelete").style.display=""):getID("btnHelpFileDelete").style.display="none"))}).catch(function(a){Log.d("err=",a)})},unzipHelpFile=function(a,b,c){var d=new URLSearchParams;d.append("productId",a);d.append("dirName",b);d.append("fileName",c);axios.post("/file/fileHelpExtract.do",
d).then(function(a){Log.d("response.data : ",a.data);"ok"==a.data.result?Log.d("unzip \ucc98\ub9ac \uc131\uacf5"):modalAlert("Unpacking failed.")}).catch(function(a){Log.d("unzipHelpFile() -> err=",a)})},sendEmail=function(a){if(getID("chkNotify").checked&&"1"==getID("selStatus").value){var b=getVal("txtEmailTitle"),c=getVal("txtEmailContent"),d=new URLSearchParams;d.append("product_id",a);0<b.length?(d.append("notice_type","custom"),d.append("subject",b),d.append("content",c)):d.append("notice_type",
"release");axios.post("/product/email",d).then(function(a){Log.d("sendEmail() -> res.data : ",a.data)}).catch(function(a){Log.d("sendEmail() -> err=",a)})}},companies={datas:[],bChanged:!1,getSelectCompany:function(a){var b=new URLSearchParams;b.append("curPage",a);b.append("pageUnit",PAGE_UNIT);b.append("product_type",queryString("productType"));Log.d("params : ",b);axios.post("/product/company/list",b).then(function(a){Log.d("ajaxcompanyL.do -> response.data : ",a.data);var b=a.data;0>=b.length||
(companies.setDatas(b),a=b[0].page,b=Math.ceil(b[0].totalcnt/PAGE_UNIT),Log.d("curPage : ",a),Log.d("pageCount : ",b),"undefined"!=typeof Pagination&&(Pagination._pageNum=b,Pagination._initPage=a,Pagination.Init(document.getElementById("pagination"),{size:Pagination._pageNum,page:Pagination._initPage,step:3})),"I"!=queryString("mode")&&companies.getSelectedCompany(queryString("productId")))}).catch(function(a){Log.d("error=",a)})},setDatas:function(a){companies.datas=[];var b=a.length;if(!(0>=b)){for(var c=
0;c<b;c++)companies.datas.push({select:!1,companyId:a[c].companyid,companyName:a[c]["Company Name"],domain:a[c].Domain,updated:utcToLoc(a[c]["Updated Date"])});Log.d("companies.datas=",companies.datas);companies.setUI()}},changeSelect:function(a,b){for(var c=0;c<this.datas.length;c++)if(this.datas[c].companyId==a){this.datas[c].select=b.checked;this.bChanged=!0;break}},setUI:function(){for(var a=getID("select-companies").innerHTML="",b="",c=0;c<companies.datas.length;c++)b+=companies.datas[c].select?
"<td><label class='ob-customcheck'><input type='checkbox' onclick='companies.changeSelect(%s, this)' style='display: none;' checked><span class='ob-checkmark'></span></label></td>".sprintf(companies.datas[c].companyId):"<td><label class='ob-customcheck'><input type='checkbox' onclick='companies.changeSelect(%s, this)' style='display: none;'><span class='ob-checkmark'></span></label></td>".sprintf(companies.datas[c].companyId),b+="<td>%s</td>".sprintf(companies.datas[c].companyName),b+="<td>%s</td>".sprintf(companies.datas[c].domain),
b+="<td>%s</td>".sprintf(companies.datas[c].updated),a+="<tr>%s</tr>".sprintf(b),b="";getID("select-companies").innerHTML=a},getSelectedCompany:function(a){var b=new URLSearchParams;b.append("productId",a);Log.d("params : ",b);axios.post("/product/company/selected",b).then(function(a){Log.d("ajaxSelectedCompany.do -> response.data : ",a.data);a=a.data;var b=a.length;if(!(0>=a.length)){for(var c=0;c<companies.datas.length;c++)for(var e=0;e<b;e++)companies.datas[c].companyId==a[e].companyid&&(companies.datas[c].select=
!0);companies.setUI()}}).catch(function(a){Log.d("companies.getSelectedCompany() -> error=",a)})},updateSelectedCompany:function(a){Log.d("updateSelectedCompany() -> productId:",a);if(null==a||""==a)Log.d("updateSelectedCompany() -> productId required."),modalAlert("Product ID is required.");else{var b=new URLSearchParams;b.append("productId",a);b.append("productType",queryString("productType"));b.append("curCompanys",JSON.stringify(this.datas));Log.d("companies.updateSelectedCompany() -> params : ",
b);axios.post("/product/company/selected/modify",b).then(function(b){Log.d("response.data : ",b.data);"ok"==b.data.result&&(sendEmail(a),Log.d("\ucc98\ub9ac \uc131\uacf52"),mv("/product/list.do?productType="+queryString("productType")+"&productName="+queryString("productName")))}).catch(function(a){Log.d("companies.updateSelectedCompany() -> err=",a)})}}};
window.addEventListener("DOMContentLoaded",function(){Log.d("productD.js -> DOMContentLoaded() called...");initPage();makeDynamicColumn();"I"!=queryString("mode")&&productDetail();companies.getSelectCompany(1)});window.onload=function(a){Log.d("productD.js -> window.onload() -> e :",a)};
null!=getID("btnSave")&&(getID("btnSave").onclick=function(a){Log.d("productD.js -> btnSave() called...");var b=getID("pgUpload");if(""==getID("txtProductName").value)modalAlert("Product name is required.");else if(""==getID("txtVersion").value)modalAlert("product version is required.");else if("1"==getID("selStatus").value&&""==getID("hdnFilename").value)modalAlert("A attachment is required when activated.");else{if("I"==queryString("mode")){if(b.uploadStatus!=UPLOAD.FINISH){modalAlert("Attachment file upload is required.");
return}}else if(b.uploadStatus==UPLOAD.PROGRESS){modalAlert("File upload is in progress.");return}if(0!=getID("attachhelpfile").files.length&&"none"==getID("bgHelpFileUploadStatus").style.display)modalAlert("Need help file upload.");else{var c=null;c=queryString("productId");a=new URLSearchParams;null!=c&&a.append("productId",c);null!=queryString("productType")&&a.append("productType",queryString("productType"));a.append("productName",getVal("txtProductName"));a.append("version",getVal("txtVersion"));
a.append("description",getVal("txtDesc"));a.append("active",getVal("selStatus"));companies.bChanged?(a.append("select_changed","1"),a.append("curCompanys",JSON.stringify(companies.datas))):a.append("select_changed","0");b.uploadStatus==UPLOAD.FINISH?(a.append("isUpload","1"),a.append("fileName",getVal("hdnFilename")),a.append("fileSize",getVal("hdnFileSize")),a.append("filePath",getVal("hdnFilepath")),a.append("OldFileName",getVal("hdnOldFilename")),a.append("OldFilePath",getVal("hdnOldFilepath")),
a.append("productFileId",getVal("hdnProductFileId"))):(a.append("isUpload","0"),a.append("fileName",""),a.append("fileSize",""),a.append("filePath",""),a.append("OldFileName",""),a.append("OldFilePath",""),a.append("productFileId",""));b=getCLS("ext_type");for(var d=b.length,f=[],e=0;e<d;e++){var g=getSuffix("_",b[e].id),h="";""!=getVal(b[e].id)&&(h=getVal(b[e].id));Log.d("ext_type : ",g,"col_value_id : ",h);f.push({ext_type:g,col_value_id:h})}Log.d("extTypes : ",f);a.append("extTypes",JSON.stringify(f));
a.append("isLinkHelp",getID("chkUseHelpLink").checked);if(getID("chkUseHelpLink").checked){if("I"==queryString("mode")&&""==getID("txtHelpLink").value){modalAlert("To use the help link, you need the help URL.");return}a.append("linkHelp",getVal("txtHelpLink"))}Log.d("params : ",a);b="";b="I"==queryString("mode")?"/product/add":"/product/modify";axios.post(b,a).then(function(a){Log.d("response.data : ",a.data);"ok"!=a.data.result?modalAlert("Processing failed."):("I"==queryString("mode")&&(c=a.data.desc),
Log.d("btnSave() -> companies.bChanged : ",companies.bChanged,"productId:",c),""!=getID("hdnHelpFilename").value&&(a="product_type_"+queryString("productType"),unzipHelpFile(c,a,getID("hdnHelpFilename").value)),Log.d("sendEmail() -> productId:",c),sendEmail(c),Log.d("\ucc98\ub9ac \uc131\uacf5"),mv("/product/list.do?productType="+queryString("productType")+"&productName="+queryString("productName")))}).catch(function(a){Log.d("err=",a)})}}});
getID("btnList").onclick=function(a){Log.d("btnList() called...");mv("/product/list.do?productType="+queryString("productType")+"&productName="+queryString("productName"))};getID("attachfile").onchange=function(a){Log.d("attachfile() -> e : ",a);a=a.target.files;Log.d("attachfile() -> uploadedFiles : ",a);getID("hdnFileSize").value=a[0].size;getID("txtFileSize").value=hFS(Number(a[0].size))};
getID("btnFileUpload").onclick=function(a){var b=getID("attachfile").files;if(0>=b.length)modalAlert("No files selected.");else{var c=getID("pgUpload");c.uploadStatus=UPLOAD.PROGRESS;Log.d("btnFileUpload() -> files: ",b);a="";null!=queryString("productType")&&(a="product_type_"+queryString("productType"));for(var d=new FormData,f=0;f<b.length;f++){var e=b[f];try{d.append("files["+f+"]",e)}catch(g){Log.d(g.message);a=e.size;a>Math.pow(2,32)&&modalAlert("File too large for normal file upload in IE.<br/>It's "+
hFS(a)+"s.");return}}document.head.querySelector("[name=_csrf_header]");b=document.head.querySelector("[name=_csrf]").content;axios.post("/file/fileR.do",d,{headers:{"Content-Type":"multipart/form-data","Dir-Name":a,csrf_header:b},onUploadProgress:function(a){a=Math.round(100*a.loaded/a.total);c.style.width=a+"%";c.innerHTML=a+"%";Log.d("btnFileUpload() -> percent : ",a)}}).then(function(a){Log.d("response.data : ",a.data);"ok"==a.data.result?(getID("hdnFilename").value=a.data.desc,getID("hdnFilepath").value=
a.data.dir,getID("spFilename").innerText=a.data.desc,Log.d("SUCCESS!! -> Uploaded filename :",a.data.desc),Log.d("SUCCESS!! -> Uploaded filedir :",a.data.dir),c.uploadStatus=UPLOAD.FINISH):modalAlert(a.data.desc)}).catch(function(a){Log.d("err=",a);Log.d("FAILED!!")})}};"I"!=queryString("mode")&&(getID("spFileDownload").onclick=function(a){Log.d("spFileDownload() called...");a=getID("hdnFilename").value;var b=getID("hdnFilepath").value;a="/file/fileD.do?filePath=%s&fileName=%s".sprintf(b,a);mv(a)});
getID("attachhelpfile").onchange=function(a){Log.d("attachhelpfile() -> e : ",a);a=a.target.files;Log.d("attachhelpfile() -> uploadedFiles : ",a);getID("hdnHelpFileSize").value=a[0].size;getID("txtHelpFileSize").value=hFS(Number(a[0].size))};
getID("btnHelpFileDelete").onclick=function(a){Log.d("btnHelpFileDelete() -> e",a);var b=function(){var a=new URLSearchParams;a.append("productId",queryString("productId"));a.append("fullPath",getID("spHelpFileFullPath").innerText);axios.post("/file/help/delete",a).then(function(a){a=a.data;0>=a.length||(Log.d("btnHelpFileDelete() -> r : ",a),"ok"==a.result&&(getID("attachhelpfile").files.length=0,getID("spHelpFileFullPath").innerText="",modalAlert("Help file deleted!!")))}).catch(function(a){Log.d("err=",
a)})};bootbox.confirm({title:"Confirmation",message:"Do you really want to delete this help file ?",buttons:{confirm:{label:"Yes",className:"btn-primary"},cancel:{label:"No",className:"btn-primary"}},callback:function(a){Log.d("callback -> r:"+a);a&&(getID("btnHelpFileDelete").style.display="none",b())}})};
getID("btnHelpFileUpload").onclick=function(a){var b=getID("attachhelpfile").files;if(0>=b.length)modalAlert("No files selected.");else{var c=getID("pgHelpUpload");getID("bgHelpFileUploadStatus").style.display="none";c.uploadStatus=UPLOAD.PROGRESS;Log.d("btnHelpFileUpload() -> files: ",b);a="";null!=queryString("productType")&&(a="product_type_"+queryString("productType"));Log.d("btnHelpFileUpload() -> dirName: ",a);for(var d=new FormData,f=0;f<b.length;f++){var e=b[f];try{d.append("files["+f+"]",
e)}catch(g){Log.d(g.message);a=e.size;a>Math.pow(2,32)&&modalAlert("File too large for normal file upload in IE.<br/>It's "+hFS(a)+"s.");return}}document.head.querySelector("[name=_csrf_header]");b=document.head.querySelector("[name=_csrf]").content;axios.post("/file/fileHelpR.do",d,{headers:{"Content-Type":"multipart/form-data","Dir-Name":a,csrf_header:b},onUploadProgress:function(a){a=Math.round(100*a.loaded/a.total);c.style.width=a+"%";c.innerHTML=a+"%";Log.d("btnHelpFileUpload() -> percent : ",
a)}}).then(function(a){Log.d("response.data : ",a.data);"ok"==a.data.result&&(getID("hdnHelpFilename").value=a.data.desc,Log.d("SUCCESS!! -> Uploaded Help filename :",a.data.desc),getID("bgHelpFileUploadStatus").style.display="",c.uploadStatus=UPLOAD.FINISH)}).catch(function(a){Log.d("err=",a);Log.d("FAILED!!")})}};"I"!=queryString("mode")&&(getID("spHelpFileLink").onclick=function(a){mvNew(getID("spHelpFileFullPath").innerText)});
getID("chkNotify").onchange=function(a){Log.d("chkNotify() -> e.target.checked : ",a.target.checked);getID("email-container").style.display="";a.target.checked?getID("email-container").style.display="":getID("email-container").style.display="none"};getID("selectAll").onchange=function(a){Log.d("selectAll() -> e.target.checked : ",a.target.checked);for(var b=0;b<companies.datas.length;b++)companies.datas[b].select=a.target.checked,companies.bChanged=!0;companies.setUI()};
var showHelpStatus=function(a){a?(getID("help-filelink").classList.remove("row-hide"),getID("help-fileupload").classList.add("row-hide"),getID("help-fileupload-pg").classList.add("row-hide")):(getID("help-fileupload").classList.remove("row-hide"),getID("help-fileupload-pg").classList.remove("row-hide"),getID("help-filelink").classList.add("row-hide"))};null!=getID("chkUseHelpLink")&&(getID("chkUseHelpLink").onclick=function(a){showHelpStatus(this.checked)});
null!=getID("btnHelpLinkDelete")&&(getID("btnHelpLinkDelete").onclick=function(a){var b=function(){var a=new URLSearchParams;a.append("productId",queryString("productId"));a.append("productType",queryString("productType"));a.append("linkHelp",getID("txtHelpLink").value);axios.post("/product/deletehelplink",a).then(function(a){a=a.data;0>=a.length||(Log.d("btnHelpLinkDelete() -> r : ",a),"ok"==a.result&&(getID("txtHelpLink").value="",modalAlert("Help link url deleted!!")))}).catch(function(a){Log.d("err=",
a)})};bootbox.confirm({title:"Confirmation",message:"Do you really want to delete this help url link ?",buttons:{confirm:{label:"Yes",className:"btn-primary"},cancel:{label:"No",className:"btn-primary"}},callback:function(a){Log.d("callback -> r:"+a);a&&b()}})});
